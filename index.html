<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Horaires de priÃ¨re - Casablanca</title>

<style>
*{box-sizing:border-box;}

html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  background:#ffffff;
  font-family: Arial, Helvetica, sans-serif;
  overflow:hidden;
  color:#111;
}

/* ===== LAYOUT ===== */

.container{
  height:100vh;
  display:flex;
  flex-direction:column;
  padding:16px 24px;
  gap:12px;
}

/* ===== TOP ===== */

.top{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.city{
  display:flex;
  align-items:center;
  gap:10px;
  font-weight:bold;
  font-size:22px;
}

.city span{
  font-size:26px;
}

.clock{
  font-size:20px;
  font-weight:bold;
}

/* ===== COUNTDOWN ===== */

.countdown-box{
  background:#f3f4f6;
  border-radius:14px;
  padding:14px 18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.count-left{
  display:flex;
  flex-direction:column;
}

.next{
  font-size:14px;
  color:#666;
}

.next strong{
  font-size:18px;
  color:#111;
}

.timer{
  font-size:36px;
  font-weight:bold;
}

/* ===== PRAYER GRID ===== */

.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  flex:1;
}

.card{
  background:#f9fafb;
  border-radius:12px;
  padding:12px;
  display:flex;
  flex-direction:column;
  justify-content:center;
}

.card-title{
  font-size:13px;
  color:#666;
  display:flex;
  align-items:center;
  gap:6px;
}

.card-time{
  font-size:22px;
  font-weight:bold;
  margin-top:6px;
}

.active{
  background:#ffffff;
  box-shadow:0 4px 14px rgba(0,0,0,0.06);
  border:1px solid #e5e7eb;
}

/* ===== FOOTER ===== */

.footer{
  font-size:11px;
  color:#888;
  text-align:right;
}

</style>
</head>

<body>

<div class="container">

  <div class="top">
    <div class="city">
      <span>ðŸ•Œ</span> Casablanca
    </div>
    <div class="clock" id="clock">--:--:--</div>
  </div>

  <div class="countdown-box">
    <div class="count-left">
      <div class="next">Prochaine priÃ¨re :</div>
      <div><strong id="nextLabel">--</strong></div>
    </div>
    <div class="timer" id="countdown">--:--:--</div>
  </div>

  <div class="grid" id="prayerGrid"></div>

  <div class="footer">
    ðŸŒ™ Horaires Casablanca â€¢ MÃ©thode Maroc (21)
  </div>

</div>

<script>

const API = "https://api.aladhan.com/v1/timingsByCity?city=Casablanca&country=Morocco&method=21";

const PRAYERS = [
  {key:"Fajr", emoji:"ðŸŒ™"},
  {key:"Sunrise", emoji:"ðŸŒ…"},
  {key:"Dhuhr", emoji:"â˜€ï¸"},
  {key:"Asr", emoji:"ðŸ•“"},
  {key:"Maghrib", emoji:"ðŸŒ‡"},
  {key:"Isha", emoji:"ðŸŒƒ"}
];

let remaining = 0;

function pad(n){ return String(n).padStart(2,'0'); }

function updateClock(){
  const now = new Date();
  document.getElementById("clock").innerText =
    pad(now.getHours())+":"+pad(now.getMinutes())+":"+pad(now.getSeconds());
}

function secondsSinceMidnight(date){
  return date.getHours()*3600 + date.getMinutes()*60 + date.getSeconds();
}

function hhmm(v){
  return (v || "").split(" ")[0];
}

function computeNext(timings){
  const now = new Date();
  const nowSec = secondsSinceMidnight(now);

  for(let p of PRAYERS){
    const t = hhmm(timings[p.key]);
    const [h,m] = t.split(":").map(Number);
    const sec = h*3600 + m*60;
    if(sec > nowSec){
      return {name:p.key, emoji:p.emoji, time:t, remaining:sec-nowSec};
    }
  }

  // Next day Fajr
  const fajr = hhmm(timings["Fajr"]);
  const [fh,fm] = fajr.split(":").map(Number);
  const secFajr = fh*3600 + fm*60;
  return {name:"Fajr", emoji:"ðŸŒ™", time:fajr, remaining:(86400-nowSec)+secFajr};
}

function formatCountdown(sec){
  sec = Math.max(0,sec);
  const h = Math.floor(sec/3600);
  const m = Math.floor((sec%3600)/60);
  const s = sec%60;
  return pad(h)+":"+pad(m)+":"+pad(s);
}

async function loadData(){
  try{
    const res = await fetch(API);
    const data = await res.json();
    const timings = data.data.timings;

    const next = computeNext(timings);
    remaining = next.remaining;

    document.getElementById("nextLabel").innerText =
      next.emoji+" "+next.name+" Ã  "+next.time;

    const grid = document.getElementById("prayerGrid");
    grid.innerHTML="";

    PRAYERS.forEach(p=>{
      const t = hhmm(timings[p.key]);
      const active = p.key === next.name ? "card active" : "card";

      grid.innerHTML += `
        <div class="${active}">
          <div class="card-title">${p.emoji} ${p.key}</div>
          <div class="card-time">${t}</div>
        </div>
      `;
    });

  }catch(e){
    document.getElementById("nextLabel").innerText="Erreur connexion";
  }
}

function tickCountdown(){
  if(remaining>0) remaining--;
  document.getElementById("countdown").innerText =
    formatCountdown(remaining);
}

updateClock();
setInterval(updateClock,1000);

loadData();
setInterval(loadData,21600000);
setInterval(tickCountdown,1000);

</script>

</body>
</html>
